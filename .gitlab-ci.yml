image: "rust:latest"

# Optional: Install a C compiler, cmake and git into the container.
# You will often need this when you (or any of your dependencies) depends on C code.
# before_script:
#   - apt-get update -yqq
#   - apt-get install -yqq --no-install-recommends build-essential

stages:
  - sanity
  - test
  - build

cache:
  key: "$CI_BUILD_STAGE-$CI_BUILD_REF_NAME"
  untracked: true

# Use rustfmt to check code formatting
rustfmt:
  stage: sanity
  script:
    - rustup component add rustfmt
    - cargo fmt -- --check

# Use clippy to detect code problems
clippy:
  stage: sanity
  script:
    - rustup component add clippy
    - cargo clippy -- -D warnings

# Use cargo to test the project
test:cargo:
  stage: test
  script:
    - rustc --version && cargo --version  # Print version info for debugging
    - cargo test --all --verbose

# Use cargo to build the project
build:cargo:
  stage: build
  script:
    - cargo build

