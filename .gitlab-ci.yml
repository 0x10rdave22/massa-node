image: "rust:latest"

# Optional: Install a C compiler, cmake and git into the container.
# You will often need this when you (or any of your dependencies) depends on C code.
# before_script:
#   - apt-get update -yqq
#   - apt-get install -yqq --no-install-recommends build-essential

cache:
  key: one-key-to-rule-them-all

# Use cargo to test the project
test:cargo:
  script:
    - rustc --version && cargo --version  # Print version info for debugging
    - cargo test --all --verbose

# Configure and run rustfmt on nightly
# Exits and builds fails if on bad format
rustfmt:
  stage: check
  script:
  - rustc --version && cargo --version
  - cd rust/
  - cargo install rustfmt-nightly --force
  - cargo fmt --all -- --write-mode=diff


# Configure and run clippy on nightly
# Only fails on errors atm.
clippy:
  stage: check
  script:
  - rustc --version && cargo --version
  - cd rust/
  - cargo install clippy --force
  - cargo clippy --all

